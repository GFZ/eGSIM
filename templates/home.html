<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" style="height:100%" lang="en">
<head>
	{% load static %}
	<meta charset="UTF-8">
	<title>{{ project_name }}</title>

	<!-- LEAFLET (http://leafletjs.com/download.html) -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.0/dist/leaflet.css"
		integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
		crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.3.0/dist/leaflet.js"
		integrity="sha512-C7BBF9irt5R7hqbUm2uxtODlUVs+IsNu2UULGuZN7gM+k/mmeG4xvIEac01BtQa4YIkUpp23zZC4wIwuXaPMQA=="
		crossorigin=""></script>


	<!-- ESRI PLUGINS http://esri.github.io/esri-leaflet/examples/ -->
	<script type="text/javascript" src="https://unpkg.com/esri-leaflet@2.1.2/dist/esri-leaflet.js"></script>

	<!-- font awesome (e.g. required by easybutton & sidebar) FIXME: CHECK LICENSE (MIT) -->
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<!-- BOOTSTRAP (3.3.7) -->
	<!-- must be loaded below / after autocomplete! FIXME: what does this mean?? -->
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"
			integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- material design for bootsrap (css only) COMMENT IF NOT NEEDED -->
	<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons">
	<link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous"> -->
			
	<!-- bootstrap js temporarily added. It requires jQuery. Maybe in the future remove both -->
	<!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js"
		integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
		crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
			integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	 -->
	
	
	<!-- Leaflet shapefile plugin - see: https://github.com/calvinmetcalf/leaflet.shapefile -->
	<script type="text/javascript" src="https://cdn.rawgit.com/calvinmetcalf/leaflet.shapefile/gh-pages/shp.js"></script>

	<!-- angular -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.7/angular.min.js"></script>
	
	<!-- plotly -->
	<script type="text/javascript" src="https://cdn.plot.ly/plotly-1.33.1.min.js"></script>
	
	
	<!--  THESE ARE FALLBACKS, COMMENT OUT IF NOT NEEDED -->
	<script type='text/javascript'>
	if (!navigator.onLine){
		//document.write("<script type='text/javascript' src='/static/fallbacks/jquery.3.2.1.js'><\/script>");
		document.write("<link rel='stylesheet' type='text/css' href='/static/fallbacks/bootstrap.3.3.7.css'/>");
		//document.write("<script type='text/javascript' src='/static/fallbacks/bootstrap.3.3.7.js'><\/script>");
		document.write("<link rel='stylesheet' type='text/css' href='/static/fallbacks/font-awesome.4.7.0.css'/>");
		document.write("<script type='text/javascript' src='/static/fallbacks/leaflet.1.3.0.js'><\/script>");
		document.write("<link rel='stylesheet' type='text/css' href='/static/fallbacks/leaflet.1.3.0.css'/>");
		document.write("<script type='text/javascript' src='/static/fallbacks/esri-leaflet.2.1.2.js'><\/script>");
		document.write("<script type='text/javascript' src='/static/fallbacks/shp.js'><\/script>");
		document.write("<script type='text/javascript' src='/static/fallbacks/angular.1.6.7.js'><\/script>");
		document.write("<script type='text/javascript' src='/static/fallbacks/plotly.1.33.1.js'><\/script>");
	}
	</script>
	
	<!-- my stuff  -->
	<link rel="stylesheet" type="text/css" href="{% static 'css/gmpe_mapstyle.css' %}"><!-- own leaflet style def -->
	
	
	<script type="text/javascript">  // init angular app:
		var ngApp = angular.module("{{ project_name }}", []); 
	</script>
	
	<!--  our stuff  -->  
	<script type="text/javascript" src="{% static 'js/classes.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/trMap.js' %}"></script>
	
	<script type="text/javascript" src="{% static 'js/ng/services/gsimsInput.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/ng/services/trellisData.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/ng/controllers/mainCtrl.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/ng/controllers/confRupture.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/ng/controllers/trellisPlots.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/ng/controllers/dataAnalysis.js' %}"></script>

	{% block extrahead %}{% endblock %}
</head>

<body>
	<div id="gfz_gmpe_site_wrapper" ng-app="{{ project_name }}" ng-controller="mainController"
		class="flex-direction-col">
		
		<!-- ººººº NAVBAR ººººº -->
		<nav class="navbar navbar-inverse">
			<div class="container-fluid">

				<!-- navbar entries: a dropdownmenu with program services (e.g., calculate trellis plots) -->
				<div class="collapse navbar-collapse">
					
					<ul class="nav navbar-nav">
						<li class="dropdown" ng-init='dropdown=false' ng-class="{'open': dropdown}">
							<a ng-click="dropdown=!dropdown" class="dropdown-toggle" href="#" onClick="return false;">
								<b>{{ project_name }}</b>
								{% verbatim %} {{ service.name != 'Home' ? " / " + service.name : "" }} {% endverbatim %}
								<span class="caret"></span>
							</a>
							<ul class="dropdown-menu">
								<li ng-repeat="sName in serviceNames" > 
									<a href="#" ng-click="service.name = sName" onClick="return false;">
										{% verbatim %} {{ sName }} {% endverbatim %}
									</a>
								</li>
							</ul>
						</li>
					</ul>

					<!-- current selected services submenus (anchor tags horizontally aligned., e.g. "Inpiut Selection", "Result",...) -->
					<ul ng-repeat="sName in serviceNames"
						ng-show="service.name == sName"
						class="nav navbar-nav">
						<li ng-repeat="subMenu in subMenuNames(sName) track by $index"
							ng-class="{'active': service.subMenu.index == $index}">
							<a href="#" onclick="return false;" ng-click="service.subMenu.index = $index">
								<span class="glyphicon glyphicon-chevron-right" aria-hidden="true">
								</span>{% verbatim %} {{ subMenu }} {% endverbatim %}
							</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		
		<div class='flex-direction-row flexible' ng-show="service.name === SERVICE_HOME">
		
		</div>

		<div class='flex-direction-row flexible' ng-show="service.name !== SERVICE_HOME">
			<!-- ººººº  NAV-DIV (GO TO PREVIOUS)  ººººº -->
			<div ng-show="service.subMenu.canMoveBack"
				class='page-scroller'>
				<button ng-click="service.subMenu.moveBack()">
					<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
				</button>
			</div>
				     		
			<!-- ººººº GSIM SELECTION ººººº -->
			<div ng-show="service.subMenu.index == 0"
				class='flex-direction-row flexible-half'>

				<div class="flex-direction-col flexible">
				
					<legend>Ground-shaking intensity model (GSIM):</legend>
				
					<div class="flex-direction-col flexible">
						<select multiple class="form-control flexible" id="selectable_gsims"
							ng-model="temporarySelectedGsims">
							<option ng-repeat="gsim in gsimsInput.avalGsims | filter:gsimsFilter" ng-value="gsim">
								{% verbatim %} {{ gsim }} {% endverbatim %}
							</option>
						</select>
						<div>
							{% verbatim %}
							{{ visibleGsimsCount }} of {{ gsimsInput.avalGsimsCount }} visible 
							({{ gsimsInput.avalGsimsCount - visibleGsimsCount }} filtered out),
							{{ temporarySelectedGsims.length }} selected
							{% endverbatim %}
						</div>
					</div>
				
					<div>
						Filter By
						<select ng-change='filterSelected()' ng-model="filterTypeName"
							ng-options="key as key for key in filterTypeNames" class="form-control"></select>
						matching:
						<input ng-model="filterText" type="text" class="form-control"
							placeholder="Input Text (*=matches any character zero or more times, ?=matches any character exactly one time)"
							autofocus>
					</div>
				</div>

				{% include "navarrow.html" with ngclick="setSelectedGsims()" class="btn btn-primary" %}

			</div>
			
 			<!-- ººººº TRT MAP ººººº -->
 			<div ng-show="(service.subMenu.index <= 1) && filterTypeName==filterTypeNames[2]"
				class="flex-direction-col flexible-half" style='z-index: 1000;'> 
				
				<div class='flexible' id='{% verbatim %}{{ _trMapID }}{% endverbatim %}'></div>
				
				<div>Project:
					<select ng-show='mapManager.ready' ng-model="mapManager.projectName"
						ng-model-options="{ getterSetter: true }"
						ng-options="key as key for key in mapManager.projectNames"
						class="form-control"></select>
				</div>
			</div>

			<!-- ººººº SELECTED GSIMS ººººº -->
			<div ng-show="(service.subMenu.index <= 1) && filterTypeName!=filterTypeNames[2]"
				class="flex-direction-row flexible-half">

				<div class="flex-direction-col flexible">
					
					<legend>Selected GSIMs:</legend>
					<div class='flexible' style='overflow:auto'>
						<div ng-repeat="gsim in gsimsInput.gsims" class="alert alert-success alert-dismissable">
							<a ng-click="gsimsInput.deleteGsims([gsim])" href="#" click='return false;' 
								class="close" data-dismiss="alert" aria-label="close">&times;</a>
							<strong>{% verbatim %} {{ gsim }} {% endverbatim %}</strong>
						</div>
					</div>
					
					<legend>Intensity Measure Types (IMTs):</legend>
					<div>
						<button class='btn btn-default' ng-repeat='imt in gsimsInput.avalImts'
							ng-disabled="!gsimsInput.isImtSelectable(imt)"
							ng-class="{'btn-success': gsimsInput.imt == imt}"
							ng-click="gsimsInput.imt = imt">
							{% verbatim %} {{ imt }} {% endverbatim %}
						</button>
					</div>
				</div>
				
				{% include "navarrow.html" with ngshow="(service.subMenu.index == 0) && gsimsInput.isValid" ngclick="service.subMenu.moveNext()" %}

			</div>
			
			<!-- ººººº TRELLIS / CONFIG. SCENARIO ººººº -->
			<div ng-show="(service.name === SERVICE_TRELLIS_PLOTS) && (service.subMenu.index == 1)" 
				class="flex-direction-row flexible-half"
				ng-controller="confRuptureController">
				
					<div class="flex-direction-col flexible">
						<legend>Configure Scenario:</legend>
						<div class="flexible">
							<form  name="c_r_form"  id='c_r_form' ng-submit="submitForm()">
							<!-- For info: https://stackoverflow.com/questions/8474409/django-forms-and-bootstrap-css-classes-and-divs -->
							{% for field in form.visible_fields %}
							<div class="row">
								<div class="col-md-4">{{ field.label_tag }}</div>
								<div class="col-md-8">{{ field }}  <!--{perc render_field field class+="form-control" %} -->
										{% if field.help_text %}
										<p class="help-inline"><small>{{ field.help_text }}</small></p>
										{% endif %}
								</div>
							</div>
							{% endfor %}
							<!-- that's really, really horrible. To make form validation work (at least for required fields) from the browser,
							and then call the angular function, we ended up writing an hidden submit button which is called by the 'arrow'
							button below. After googling, the proposed solutions where all complex or clumsy
							FIXME: isn't really a better way?-->
							<input id='abcd' type=submit value="Ok" style='display:none'>
							</form>
						</div>
						<div>
						{% verbatim %} {{ _rp() }} {% endverbatim %}
						</div>
					</div>
				
				
				{% include "navarrow.html" with ngshow="isValid()" onclick="document.getElementById('abcd').click()" %}
				
			</div>
			
			<!-- ººººº TRELLIS / PLOTS ººººº -->
			<div ng-show="(service.name === SERVICE_TRELLIS_PLOTS) && (service.subMenu.index == 2)"
				class="flex-direction-row flexible-half" ng-controller="trellisPlots">
				<div class="flex-direction-col flexible">
					<div class="flex-direction-row">
						<select ng-model="trellisData.selName" ng-model-options="{ getterSetter: true }"
							ng-options="key as key for key in trellisData.names" class="form-control flexible"></select>
						<select ng-model="trellisData.selType" ng-model-options="{ getterSetter: true }"
							ng-options="key as key for key in trellisData.types" class="form-control"></select>
					</div>
					<div id='trellisContainer' class="flex-direction-col flexible"
						style='flex-basis:100%'> <!-- <-- really important to correctly display plot grid, as it forces
														  the container to have all aval. height -->
						<div class="flex-direction-row flexible" ng-repeat="r in rowsArray"
							ng-attr-style="flex: {% verbatim %}{{ '0 0 ' + plotsH() + '%' }}{% endverbatim %}">
							<div class="flexible plot-container"
								ng-repeat="c in colsArray"
								ng-attr-style="flex: {% verbatim %}{{ '0 0 ' + plotsW() + '%' }}{% endverbatim %}"
								ng-attr-id="{% verbatim %}{{ 'trellisplot-' + r + '-' + c }}{% endverbatim %}">
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- ººººº DATAANALYSIS / TO BE DONE ººººº -->
			<!-- For each next div (if any), just replace service.subMenu.index == 1 with service.subMenu.index == 2,... -->
			<div ng-show="(service.name === SERVICE_DATA_ANALYSIS) && (service.subMenu.index == 1)"  
				class="flex-direction-row flexible-half">
				<div class="flex-direction-col flexible">
					data analysis
				</div>
				<div class="form-inline">
					
				</div>
			</div>

		</div>

		<!-- div housing errors. Set debug=false in django for less verbosity
		For info see: https://stackoverflow.com/questions/10418644/creating-an-iframe-with-given-html-dynamically/10433550#10433550
		 -->
		 <!-- ººººº ERRORS ººººº -->
		 <div ng-show='hasError' class="alert alert-danger alert-dismissable"> <!--  -->
			<a href="#" click='return false' ng-click="hasError=false" class="close" data-dismiss="alert" aria-label="close">&times;</a>
			<iframe id='errFrame'></iframe>
		</div>

	</div>
</body>


</html>
