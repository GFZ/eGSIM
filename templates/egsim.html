{% extends 'base.html' %}

{% block head %}
	{% with vue=True plotly=True leaflet=True axios=True fontawesome=True %}
		{{ block.super }}
	{% endwith %}
	<!-- includes css for form-related stuff (e.g. waitbar)  -->
	<link rel="stylesheet" type="text/css" href="{% static 'css/egsim.css' %}">
{% endblock %}

{% block body %}
	<div class="d-flex flex-column height100" id='egsim-vue'>

		<nav class="d-flex flex-row navbar-dark bg-dark" id='egsim-nav'>
				{% for component in components %}
                    {% if forloop.last %}
                        <div class='flexible'></div>
                    {% endif %}
					<a class='menu-item' :class="selComponent == '{{ component.0 }}' ? 'active' : ''"
							@click="setComponent('{{ component.0 }}')" title="{{ component.1 }}">
						<i class="fa {{ component.2 }}"></i> <span>{{ component.1 }}</span>
					</a>
				{% endfor %}
		</nav>

		<div class='flexible d-flex flex-column position-relative'>

			<div id='waitdiv' v-show='loading' class="position-absolute pos-t-0 pos-x-0" style='z-index:100'>
				<!-- Loading, please wait ... --> <!-- (<- text removed) -->
				<div class="loader"></div>
			</div>
	
			<div v-show='errormsg'
				class='d-flex flex-row bg-danger text-sm-center text-white text-truncate position-absolute pos-t-0 pos-x-0'
				style='z-index:10'>
				<div class='flexible ml-1'>
					&#123;&#123; errormsg &#125;&#125;
				</div>
				<button type="button" v-on:click='clearErrors()' class="close mr-1"
					style='color:inherit' aria-label="Clear error messages">
                	&times;
            	</button>
			</div>
			
			<div class='d-flex flexible position-relative mx-1 mb-2' style='margin-top: 2rem !important;'>
				<transition name="fade" mode="out-in">
				<keep-alive>
					<!-- https://vuejs.org/v2/guide/components-dynamic-async.html#keep-alive-with-Dynamic-Components -->
					<component v-bind:is="selComponent"
						v-bind="selComponentProps" v-bind:post='post'
						@gsim-selected='selectGsims'
						@movetoapidoc='moveToApidoc'></component>
				</keep-alive>
				</transition>
				{% block main %}{% endblock %}
			</div>

		</div>
	</div>

	
{% endblock %}

{% block after-body %}
	{{ block.super }}
	
	{% for component in components %}
	<script type='text/javascript' src = "{% static 'js/v-components/' %}{{ component.0 }}.js"></script>
	{% endfor %}

	<script type='text/javascript' src = "{% static 'js/v-components/base/gsimselect.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/imtselect.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/forminput.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/forminputlite.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/plotdiv.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/testingtable.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/plotdivs/trellisplotdiv.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/plotdivs/gmdbplotdiv.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/v-components/base/plotdivs/residualsplotdiv.js' %}"></script>
	<script type='text/javascript' src = "{% static 'js/egsim_base.js' %}"></script>

	<script>
	var EGSIM = new Vue({
	    el: '#egsim-vue',
	    mixins: [EGSIM_BASE],  /* defined in script above */
	    data: function(){ /* FIXME: check what's the difference between returning function and dict */
	        return {selComponent: "{{sel_component}}",
	        		errormsg: "{{ server_error_message }}",
	        		componentProps: {{ component_props|safe }},
	        		gsims: {{ gsims|safe }},
	        		};  
	    }
	});
	</script>
{% endblock %}
